-- 1. Users register themselves. If logging in with email, they can change personal information. 
INSERT INTO RegisteredUser VALUES('janejohnson@gmail.com', 'Jane Johnson', 'CA', 1);
INSERT 0 1
INSERT INTO RegisteredUser VALUES('xiaomingwang@gmail.com', 'Xiaoming Wang', 'NC', 1);
INSERT 0 1
UPDATE RegisteredUser SET district=3 WHERE email='johndoe@gmail.com';
UPDATE 1
-- 2. Display all bills with the specified category for the user.
SELECT * FROM Bill WHERE category='Health';
 type | num  | cong_year | enacted |        summary         | category | introduction_date 
------+------+-----------+---------+------------------------+----------+-------------------
 H    | 2217 |       113 | t       | Affordable Care Act... | Health   | 2010-03-23
 H    | 2218 |       113 | t       | Another act...         | Health   | 2010-03-25
(2 rows)

-- 3. Display reprensentatives/senators for the user.
-- NOTE: A senator covers an entire state, regardless of the user's specific district. A house representative covers a sepcific district within a state.
SELECT rep_id FROM RepresentedBy WHERE email='janejohnson@gmail.com';
 rep_id 
--------
      3
(1 row)

SELECT rep_id FROM RepresentedBy WHERE email='xiaomingwang@gmail.com';
 rep_id 
--------
      1
      2
(2 rows)

-- 4. Display all sponsorships by a reprensentative.
SELECT s.bill_type, s.bill_num FROM SponsoredBy s, Congressman c
WHERE s.rep_id=c.id and c.name='Kamala Harris';
 bill_type | bill_num 
-----------+----------
 H         |     2218
(1 row)

-- 5. Display all votes by a representative.
SELECT v.bill_type, v.bill_num, v.decision FROM Vote v, Congressman c
WHERE v.rep_id=c.id and c.name='George Butterfield Jr.';
 bill_type | bill_num | decision 
-----------+----------+----------
 H         |     2217 | Aye
 H         |     2218 | Nay
 S         |     2218 | Aye
(3 rows)

-- 6. Display all representatives who voted a certain way on a bill, e.g. voted Aye on bill H-2217. 
SELECT c.name FROM Vote v, Congressman c
WHERE v.rep_id=c.id and v.bill_type='H' and v.bill_num=2217 and v.decision='Aye';
          name          
------------------------
 George Butterfield Jr.
 Kamala Harris
(2 rows)

-- 7. Display all votes on bills casted by representatives (house and senate) representing a user.
SELECT * FROM Vote v
WHERE v.rep_id in (SELECT rep_id FROM RepresentedBy WHERE email='xiaomingwang@gmail.com')
GROUP BY v.bill_type, v.bill_num, v.rep_id;
 rep_id | bill_type | bill_num | decision 
--------+-----------+----------+----------
      1 | H         |     2217 | Nay
      2 | H         |     2217 | Aye
      2 | H         |     2218 | Nay
      2 | S         |     2218 | Aye
(4 rows)

-- 8. Tally the numbers of Ayes and Nays on a bill.
SELECT sum(case when v.decision = 'Aye' then 1 else 0 end) AS Aye_Count, 
sum(case when v.decision = 'Nay' then 1 else 0 end) AS Nay_Count FROM Vote v
WHERE v.bill_type='H' and v.bill_num=2217;
 aye_count | nay_count 
-----------+-----------
         2 |         1
(1 row)

-- 9. Compare two representatives' votes.
SELECT A.bill_type, A.bill_num, A.rep_id as Rep1, A.decision as Rep1_Decision, B.rep_id as Rep2, B.decision as Rep2_Decision 
FROM ((SELECT * FROM Vote as v1 WHERE v1.rep_id=2) A JOIN (SELECT * FROM Vote as v2 WHERE v2.rep_id=3) B
	ON A.bill_type=B.bill_type and A.bill_num=B.bill_num);
 bill_type | bill_num | rep1 | rep1_decision | rep2 | rep2_decision 
-----------+----------+------+---------------+------+---------------
 H         |     2217 |    2 | Aye           |    3 | Aye
 H         |     2218 |    2 | Nay           |    3 | Aye
(2 rows)

-- 10. Display bills that are introduced after a certain date.
SELECT * FROM Bill
WHERE introduction_date>DATE(CAST('2010-03-23' AS VARCHAR));
 type | num  | cong_year | enacted |    summary     | category  | introduction_date 
------+------+-----------+---------+----------------+-----------+-------------------
 H    | 2218 |       113 | t       | Another act... | Health    | 2010-03-25
 S    | 2218 |       115 | t       | A third act... | Economics | 2014-10-23
(2 rows)

